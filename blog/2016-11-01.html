<!DOCTYPE html>
<html>
<head>
    <title>Configuring Rolling Logging with Logback</title>
    <meta name="keywords" content="grails,jvm,framework,groovy,gradle,spring-boot,gorm" />
    <meta name="description" content="Learn how to configure rolling log system in Grails® apps, so that log files are rolled over on a schedule and archived after a certain point." />
    <meta name="date" content="November 1, 2016" />
    <meta name="robots" content="all"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://grails.org/rss.xml" />
    <meta charset='UTF-8' />
    <link rel='icon' href='https://grails.org/images/favicon.ico'/>
    <meta name='twitter:card' content='summary_large_image'/>
    <meta name='twitter:site' content='@grailsframework'/>
    <meta name='twitter:description' content='Learn how to configure rolling log system in Grails® apps, so that log files are rolled over on a schedule and archived after a certain point.'/>
    <meta name='twitter:creator' content='@grailsframework'/>
    <meta property='og:image' content='https://grails.org/images/grails.png'/>
    <meta property='og:image:width' content='300'/>
    <meta property='og:image:height' content='300'/>
    <meta property='og:url' content='https://grails.org'/>
    <meta property='og:title' content='Configuring Rolling Logging with Logback'/>
    <meta property='og:description' content='Learn how to configure rolling log system in Grails® apps, so that log files are rolled over on a schedule and archived after a certain point.'/>
    <meta property='og:type' content='website'/>

    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='mask-icon' href='https://grails.org/images/grails-pinned-icon.svg' color='feb672' />
    <link rel='stylesheet' href='https://grails.org/stylesheets/screen.css' />
    <script src='https://grails.org/javascripts/navigation.js'></script>
    
    <link rel='stylesheet' href='https://grails.org/stylesheets/prism.css'/>
    <script src='https://grails.org/javascripts/prism.js'></script>
</head>
<body><header class='mainheader'>
    <div class='content'>
        <a href='https://grails.org/index.html'><img class='grailslogo' src='https://grails.org/images/grails_logo.svg' alt='Grails Logo' /></a>
        <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
        <div id='topmenus'>
            <nav class='secondarymenu' id='secondarymenu'><ul>
                <li><a href='https://grails.org/blog/index.html'>Blog</a></li>
                <li><a href='https://grails.org/learning.html'>Learning</a></li>
                <li><a href='https://grails.org/community.html'>Community</a></li>
                <li><a href='https://grails.org/search.html'>Search</a></li>
            </ul></nav>
            <nav class='mainmenu' id='mainmenu'><ul>
                <li><a href='https://grails.org/documentation.html'>Documentation</a></li>
                <li><a href='https://grails.org/download.html'>Download</a></li>
                <li><a href='https://plugins.grails.org'>Plugins</a></li>
                <li><a href='https://guides.grails.org/index.html'>Guides</a></li>
                <li><a href='https://grails.org/foundation/index.html'>Foundation</a></li>
                <li><a href='https://grails.org/faq.html'>FAQ</a></li>
                <li><a href='https://grails.org/support.html'>Support</a></li>
            </ul></nav>
        </div>
    </div>
</header>
<article><div class='headerbar chalicesbg'>
  <div class='content'>
    <h1>
      <a href='https://grails.org/blog/index.html'>Grails Blog</a>
    </h1>
  </div>
</div>
<div class='content container'>
  <div class='light padded blogpost'><h1>Configuring Rolling Logging with Logback</h1>
<p><span class="author">By Zachary Klein</span></p>
<p><span class="date">November 1, 2016</span></p>
<p>Tags: <a href="https://grails.org/blog/tag/logging.html"><span class="hashtag">#logging</span></a> <a href="https://grails.org/blog/tag/logback.html"><span class="hashtag">#logback</span></a> <a href="https://grails.org/blog/tag/config.html"><span class="hashtag">#config</span></a></p>
<p>A common requirement in web applications is to support a rolling log system, so that log files are rolled over on a schedule and archived after a certain point. Grails<sup>®</sup> 3 uses Logback (considered the successor to log4j) as its logging library, and it's quite simple to configure a rolling appender using Logback's Groovy config format.</p>
<p>The Grails framework includes a default Logback configuration at <code>grails-app/conf/logback.groovy</code>. By default (as of Grails 3.2.1), this file (which follows the standard Logback groovy config format) configures a single appender, an instance of <code>ConsoleAppender</code> called <code>STDOUT</code>, and conditionally (when in development mode) an instance of <code>FileAppender</code> called <code>FULL_STACKTRACE</code>. These may then be used by logger instances, which can target specific package names and log levels, and write to one or more appenders. You have access to the Grails <code>Environment</code>, so you can configure different combinations of appenders for development and production.</p>
<p>The default <code>logback.groovy</code> file in Grails 3.2.1 is shown below.</p>
<pre><code class="language-groovy">//grails-app/confg/logback.groovy
import grails.util.BuildSettings
import grails.util.Environment

// See http://logback.qos.ch/manual/groovy.html for details on configuration
appender('STDOUT', ConsoleAppender) {
    encoder(PatternLayoutEncoder) {
        pattern = &quot;%level %logger - %msg%n&quot;
    }
}

def targetDir = BuildSettings.TARGET_DIR
if (Environment.isDevelopmentMode() &amp;&amp; targetDir != null) {
    appender(&quot;FULL_STACKTRACE&quot;, FileAppender) {
        file = &quot;&amp;#36;{targetDir}/stacktrace.log&quot;
        append = true
        encoder(PatternLayoutEncoder) {
            pattern = &quot;%level %logger - %msg%n&quot;
        }
    }
    logger(&quot;StackTrace&quot;, ERROR, ['FULL_STACKTRACE'], false)
    root(ERROR, ['STDOUT', 'FULL_STACKTRACE'])
}
else {
    root(ERROR, ['STDOUT'])
}
</code></pre>
<p>Let's add an instance of <a href="http://logback.qos.ch/manual/appenders.html#RollingFileAppender"><code>RollingFileAppender</code></a> for our production environment. Let's say we want to split out our log files by day, and keep 30 days worth of log files around (deleting any older ones). In addition, we don't have unlimited hard drive space, so we'll also set a file size cap so that the total disk space used by our logs never exceeds 2GB.</p>
<p>Here's our new appender:</p>
<pre><code class="language-groovy">//grails-app/confg/logback.groovy
import ch.qos.logback.core.rolling.RollingFileAppender
import ch.qos.logback.core.rolling.TimeBasedRollingPolicy
import ch.qos.logback.core.util.FileSize


def HOME_DIR = &quot;.&quot;

appender(&quot;ROLLING&quot;, RollingFileAppender) {
  encoder(PatternLayoutEncoder) {
      pattern = &quot;%level %logger - %msg%n&quot;
  }
  rollingPolicy(TimeBasedRollingPolicy) {
      fileNamePattern = &quot;&amp;#36;{HOME_DIR}/logs/myApp-%d{yyyy-MM-dd_HH-mm}.log&quot;
      maxHistory = 30
      totalSizeCap = FileSize.valueOf(&quot;2GB&quot;)
  }
}
</code></pre>
<p>An instance of <code>RollingFileAppender</code> needs two &quot;policies&quot;, a <code>rollingPolicy</code> (to define how to perform the rollover), and a <code>triggerPolicy</code> (which specifies when the rollover should occur). In this case, our <code>rollingPolicy</code> is <code>TimeBasedRollingPolicy</code>, which happens to implement the <code>TriggeringPolicy</code> interface and therefore satisfies both policy requirements. <code>TimeBasedRollingPolicy</code> is one of the most common rolling policies, and it will meet the majority of rolling log requirements.</p>
<p><code>TimeBasedRollingPolicy</code> gets both it's rolling behavior (creating a new log file with the current date/time in the file name) and it's triggering behavior (rollover will occur based on the specified timestamp pattern) from the <code>fileNamePattern</code> property.</p>
<blockquote>
<h2>What's In a Name?</h2>
<p>Maybe you'd rather not have the filenames of your log files contain the trigger interval. No worries, <code>RollingFileAppender</code> also supports a <code>file</code> property which can override this behavior, so your log files can be rolled over monthly (for example) without actually containing the date string in their filenames. See the documentation for <a href="http://logback.qos.ch/manual/appenders.html#RollingFileAppender"><code>RollingFileAppender</code></a> for more details.</p>
</blockquote>
<p>The trigger policy is the most interesting part here - it takes an approach that bases the rollover occurrence on how specific you define the timestamp in the <code>fileNamePattern</code>.  So if you specify down to the month, rollover will occur each month. Specify a pattern down to the day, and it will occur daily). It's easier to understand when you see it in action, so here's some example patterns taken from Logback's documentation:</p>
<pre><code class="language-groovy">  fileNamePattern = &quot;/myApp-log.%d{yyyy-MM}.log&quot;	      //Rollover at the beginning of each month, file format: myApp-log.2016-11.log
  fileNamePattern = &quot;/myApp-log.%d{yyyy-ww}.log&quot;	      //Rollover at the first day of each week. Note that the first day of the week depends on the locale.
  fileNamePattern = &quot;/myApp-log.%d{yyyy-MM-dd_HH}.log&quot;	//Rollover at the top of each hour.
</code></pre>
<p>Note that in the above examples we are configuring the timestamp in the filename of the log files. We can also use the timestamp to create a file directory structure, like this example:</p>
<pre><code class="language-groovy">fileNamePattern = &quot;/logs/%d{yyyy/MM}/myApp.log&quot;	//Rollover at the beginning of each month.
//Each log file will be stored in a year/month directory, e.g: /logs/2016/11/myApp.log, /logs/2016/12/myApp.log, /logs/2017/01/myApp.log
</code></pre>
<p>Finally, adding a <code>zip</code> or <code>gz</code> file extension to our <code>fileNamePattern</code> will apply the selected compression to the rolled-over log files:</p>
<pre><code class="language-groovy">fileNamePattern = &quot;/myApp-log.%d{yyyy/MM}.gz&quot;	      //Rollover at the beginning of each month, compress the rolled-over file with GZIP
</code></pre>
<p>Going back to our previous example, we're setting a couple more properties on our <code>TimeBasedRollingPolicy</code> -  <code>maxHistory</code> and <code>totalSizeCap</code>. These are pretty simple to understand; <code>maxHistory</code> sets the upper limit on how many log files to preserve (when the max is reached the oldest file is deleted), and <code>totalSizeCap</code> sets a cap on how much disk space our log files are allowed to use (again, when the cap is reached the oldest files are deleted). There are other useful options you can set here, see the <a href="http://logback.qos.ch/manual/appenders.html#TimeBasedRollingPolicy"><code>TimeBasedRollingPolicy</code> documentation</a> for a full list and explanation.</p>
<blockquote>
<h2>Warning!</h2>
</blockquote>
<blockquote>
<p>While the Logback docs suggest that <code>totalSizeCap</code> can be specified as a plain String (i.e, &quot;2GB&quot;), I've found that it needs to be specified as a <code>FileSize</code> to avoid casting exceptions - so make sure to use <code>FileSize.valueOf(&quot;2GB&quot;)</code> to evaluate your total size. This also applies to the <code>maxFileSize</code> property used in the <code>SizeBasedRollingPolicy</code> and <code>TimeAndSizeBasedRollingPolicy</code>.</p>
</blockquote>
<p>There are several more <a href="http://logback.qos.ch/manual/appenders.html#onRollingPolicies">rolling &amp; triggering policies</a> that are available, including <a href="http://logback.qos.ch/manual/appenders.html#SizeBasedTriggeringPolicy"><code>SizeBasedTriggerPolicy</code></a> and <a href="http://logback.qos.ch/manual/appenders.html#SizeAndTimeBasedRollingPolicy"><code>SizeAndTimeBasedTriggeringPolicy</code></a>, and <code>FixedWindowRollingPolicy</code></p>
<p>Finally, let's specify that we want our new <code>RollingFileAppender</code> to be used in production mode only, while keeping the default <code>ConsoleAppender</code> for development mode.</p>
<pre><code class="language-groovy">//grails-app/confg/logback.groovy
import grails.util.BuildSettings
import grails.util.Environment
import ch.qos.logback.core.rolling.RollingFileAppender
import ch.qos.logback.core.rolling.TimeBasedRollingPolicy
import ch.qos.logback.core.util.FileSize

def HOME_DIR = &quot;.&quot;

// See http://logback.qos.ch/manual/groovy.html for details on configuration
appender('STDOUT', ConsoleAppender) {
    encoder(PatternLayoutEncoder) {
        pattern = &quot;%level %logger - %msg%n&quot;
    }
}

appender(&quot;ROLLING&quot;, RollingFileAppender) {
  encoder(PatternLayoutEncoder) {
      pattern = &quot;%level %logger - %msg%n&quot;
  }
  rollingPolicy(TimeBasedRollingPolicy) {
      fileNamePattern = &quot;&amp;#36;{HOME_DIR}/logs/myApp-%d{yyyy-MM-dd_HH-mm}.log&quot;
      maxHistory = 30
      totalSizeCap = FileSize.valueOf(&quot;2GB&quot;)
  }
}

def targetDir = BuildSettings.TARGET_DIR
if (Environment.isDevelopmentMode() &amp;&amp; targetDir != null) {
    appender(&quot;FULL_STACKTRACE&quot;, FileAppender) {
        file = &quot;&amp;#36;{targetDir}/stacktrace.log&quot;
        append = true
        encoder(PatternLayoutEncoder) {
            pattern = &quot;%level %logger - %msg%n&quot;
        }
    }

    logger(&quot;StackTrace&quot;, ERROR, ['FULL_STACKTRACE'], false)
    root(ERROR, ['STDOUT', 'FULL_STACKTRACE'])
}
else {
    root(ERROR, ['ROLLING'])
}
</code></pre>
<p>And with that, we have our rolling log system. Enjoy!</p>
<h2>Resources</h2>
<ul>
<li>Logback documentions: <a href="http://logback.qos.ch/documentation.html">http://logback.qos.ch/documentation.html</a></li>
<li>Logback Groovy config (from the official docs): <a href="http://logback.qos.ch/manual/groovy.html">http://logback.qos.ch/manual/groovy.html</a></li>
<li>DZone - Logback Configuration Using Groovy:  <a href="https://dzone.com/articles/logback-configuration-using-groovy">https://dzone.com/articles/logback-configuration-using-groovy</a></li>
</ul>
    <h2 class='space-above'>
      <span>You might also like ...</span>
    </h2>
    <div class='threecolumns'>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/grails-blog-index-4.png)'>
  <a href='https://grails.org/blog/2021-02-05-2gm-town-hall-q1.html'>
    <h3>February 5, 2021</h3>
    <h2>Webinar: 2GM TOWN HALL MEETING: 2021 Q1</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/grails-blog-index-1.png)'>
  <a href='https://grails.org/blog/2021-01-22-grails-exciting-updates.html'>
    <h3>January 22, 2021</h3>
    <h2>Grails Framework Exciting Updates</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/grails-blog-index-5.png)'>
  <a href='https://grails.org/blog/2020-10-26-grails-foundation-announcement.html'>
    <h3>October 26, 2020</h3>
    <h2>Grails® Foundation Announced</h2>
  </a>
</article></div>
    </div>
  </div>
</div>&nbsp;</article>
<footer>
    <div class='content'>
        <div class='ocihometograils'>
            <span>Sponsored by</span>
            <a href='https://objectcomputing.com/products/grails/'><img class='' src='https://grails.org/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
        </div>
        <nav class='socialmedianav'><ul>
            <li>
                <a href='https://slack.grails.org'><img class='' src='https://grails.org/images/slack.svg' alt='Slack Icon' /></a>
            </li>
            <li>
                <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='https://grails.org/images/youtube.svg' alt='Youtube Icon' /></a>
            </li>
            <li>
                <a href='https://www.linkedin.com/groups/39757'><img class='' src='https://grails.org/images/linkedin.svg' alt='LinkedIn Icon' /></a>
            </li>
            <li>
                <a href='https://github.com/grails/'><img class='' src='https://grails.org/images/github.svg' alt='Github Icon' /></a>
            </li>
            <li>
                <a href='https://twitter.com/grailsframework'><img class='' src='https://grails.org/images/twitter.svg' alt='Twitter Icon' /></a>
            </li>
        </ul></nav>
        <nav class='partnersnav'><ul>
            <li>Grails' repositories are hosted by
                <a href='http://artifactoryonline.com/'>Artifactory</a>
            </li>
            <li>Website hosting provided by
                <a href="https://aws.amazon.com/">AWS</a>
            </li>
            <li>JetBrains supports Grails with its
                <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
            </li>
            <li>YourKit supports Grails with its
                <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
            </li>
            <li>Grails is Open Source
                <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache 2 License</a>
            </li>
            <li>
                <a href='https://grails.org/buildstatus.html'>Build Status</a>
            </li>
        </ul></nav>
    </div>
</footer><div>
    <script type='text/javascript'>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-82213539-2', 'auto');
        ga('send', 'pageview');
    </script>
    <script type='text/javascript'>
        adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
        adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
        /* OPTIONAL: provide email to improve user identification */
        /* adroll_email = "username@example.com"; */
        (function () {
            var _onload = function(){
                if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
                if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
                var scr = document.createElement("script");
                var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
                scr.setAttribute('async', 'true');
                scr.type = "text/javascript";
                scr.src = host + "/j/roundtrip.js";
                ((document.getElementsByTagName('head') || [null])[0] ||
                    document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
            };
            if (window.addEventListener) {window.addEventListener('load', _onload, false);}
            else {window.attachEvent('onload', _onload)}
        }());
    </script>
</div>
</body>
</html>
