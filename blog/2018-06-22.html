<!DOCTYPE html>
<html>
<head>
    <title>Mock vs Stub vs Spy</title>
    <meta name="keywords" content="grails,jvm,framework,groovy,gradle,spring-boot,gorm" />
    <meta name="description" content="Learn the differences between Mock, Stub, and Spy" />
    <meta name="date" content="June 22, 2018" />
    <meta name="robots" content="all"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://grails.org/rss.xml" />
    <meta charset='UTF-8' />
    <link rel='icon' href='https://grails.org/images/favicon.ico'/>
    <meta name='twitter:card' content='summary_large_image'/>
    <meta name='twitter:site' content='@grailsframework'/>
    <meta name='twitter:description' content='Learn the differences between Mock, Stub, and Spy'/>
    <meta name='twitter:creator' content='@grailsframework'/>
    <meta property='og:image' content='https://grails.org/images/grails.png'/>
    <meta property='og:image:width' content='300'/>
    <meta property='og:image:height' content='300'/>
    <meta property='og:url' content='https://grails.org'/>
    <meta property='og:title' content='Mock vs Stub vs Spy'/>
    <meta property='og:description' content='Learn the differences between Mock, Stub, and Spy'/>
    <meta property='og:type' content='website'/>

    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='mask-icon' href='https://grails.org/images/grails-pinned-icon.svg' color='feb672' />
    <link rel='stylesheet' href='https://grails.org/stylesheets/screen.css' />
    <script src='https://grails.org/javascripts/navigation.js'></script>
    
    <link rel='stylesheet' href='https://grails.org/stylesheets/prism.css'/>
    <script src='https://grails.org/javascripts/prism.js'></script>
</head>
<body><header class='mainheader'>
    <div class='content'>
        <a href='https://grails.org/index.html'><img class='grailslogo' src='https://grails.org/images/grails_logo.svg' alt='Grails Logo' /></a>
        <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
        <div id='topmenus'>
            <nav class='secondarymenu' id='secondarymenu'><ul>
                <li><a href='https://grails.org/blog/index.html'>Blog</a></li>
                <li><a href='https://grails.org/learning.html'>Learning</a></li>
                <li><a href='https://grails.org/community.html'>Community</a></li>
                <li><a href='https://grails.org/search.html'>Search</a></li>
            </ul></nav>
            <nav class='mainmenu' id='mainmenu'><ul>
                <li><a href='https://grails.org/documentation.html'>Documentation</a></li>
                <li><a href='https://grails.org/download.html'>Download</a></li>
                <li><a href='https://plugins.grails.org'>Plugins</a></li>
                <li><a href='https://guides.grails.org/index.html'>Guides</a></li>
                <li><a href='https://grails.org/foundation/index.html'>Foundation</a></li>
                <li><a href='https://grails.org/faq.html'>FAQ</a></li>
                <li><a href='https://grails.org/support.html'>Support</a></li>
            </ul></nav>
        </div>
    </div>
</header>
<article><div class='headerbar chalicesbg'>
  <div class='content'>
    <h1>
      <a href='https://grails.org/blog/index.html'>Grails Blog</a>
    </h1>
  </div>
</div>
<div class='content container'>
  <div class='light padded blogpost'><h1>Mock vs Stub vs Spy</h1>
<p><span class="author">By Dean Del Ponte</span></p>
<p><span class="date">June 22, 2018</span></p>
<p>Tags: <a href="https://grails.org/blog/tag/spock.html"><span class="hashtag">#spock</span></a></p>
<h2>Introduction</h2>
<p><a href="https://spockframework.org/">Spock</a> provides three powerful yet distinct, tools that make working with collaborators easier:</p>
<ul>
<li><a href="https://spockframework.org/spock/docs/1.1/all_in_one.html#_creating_mock_objects">Mocks</a></li>
<li><a href="https://spockframework.org/spock/docs/1.1/all_in_one.html#Stubs">Stubs</a></li>
<li><a href="https://spockframework.org/spock/docs/1.1/all_in_one.html#Spies">Spies</a></li>
</ul>
<p>Quite often, the code that is under test is required to interact with outside units of code known as <a href="https://spockframework.org/spock/docs/1.1/all_in_one.html#_terminology">collaborators</a>. Unit tests are most often designed to focus on testing one class in isolation through the use of Mocks, Stubs or Spies. Tests are more robust and less prone to breakage should the collaborator code evolve.</p>
<p>These isolated tests are less brittle and less prone to breakage should the collaborators' internals be modified.</p>
<h2>TLDR</h2>
<h3>Mocks</h3>
<p>Use Mocks to:</p>
<ul>
<li>verify the contract between the code under test and a collaborator</li>
<li>verify the the collaborator's method is called the correct number of times</li>
<li>verify the collaborator's method is called with the correct parameters</li>
</ul>
<h3>Stubs</h3>
<p>Use Stubs to:</p>
<ul>
<li>provide a predetermined response from a collaborator</li>
<li>take a predetermined action from a collaborator, like throwing an exception</li>
</ul>
<h3>Spies</h3>
<p>Beware of Spies. As the Spock documentation states:</p>
<blockquote>
<p>Think twice before using this feature. It might be better to change the design of the code under specification.</p>
</blockquote>
<p>That being said, there are situations when we must work with legacy code. This legacy code may be difficult or impossible to test with Mocks or Stubs. In this case, Spies may be our only viable option.</p>
<p>It's better to have legacy code that is tested with a Spy then it is to have legacy code that is not tested at all.</p>
<p>Use Spies to:</p>
<ul>
<li>test legacy code collaborators that are too difficult or impossible to test with a Mock or Spy</li>
<li>verify the collaborator's method is called the correct number of times</li>
<li>verify the collaborator's method is called with the correct parameters</li>
<li>provide a predetermined response from a collaborator</li>
<li>take a predetermined action from a collaborator, like throwing an exception</li>
</ul>
<h2>Mocks</h2>
<p>The power of Mocks really shines when the goal of a unit test is to validate the contract between the code under test and a collaborator.</p>
<p>Let's take a look at the following example where we have a controller, <code>FooController</code>, which utilizes <code>FooService</code> as a collaborator and then test the functionality with a Mock.</p>
<p>FooController.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import groovy.transform.CompileStatic

@CompileStatic
class FooController {
    FooService fooService

    def doSomething() {
        render fooService.doSomething(&quot;Sally&quot;)
    }
}
</code></pre>
<p>FooService.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import groovy.transform.CompileStatic

@CompileStatic
class FooService {

    String doSomething(String name) {
        &quot;Hi &amp;#36;{name}, FooService did something&quot;
    }
}
</code></pre>
<p>In this scenario, we want to write a test that will validate:</p>
<ul>
<li>the contract between <code>FooController</code> and <code>FooService</code></li>
<li><code>FooService.doSomething(name)</code> is called the correct number of times</li>
<li><code>FooService.doSomething(name)</code> is passed the correct parameter</li>
</ul>
<p>Here's the test:</p>
<p>MockSpec.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import grails.testing.web.controllers.ControllerUnitTest
import spock.lang.Specification

class MockSpec extends Specification implements ControllerUnitTest&lt;FooController&gt; {

    void &quot;Mock FooService&quot;() {
        given: &quot;the collaborating service is mocked&quot;
        def fooService = Mock(FooService)

        and: &quot;the mocked service is set on the controller&quot;
        controller.fooService = fooService

        when: &quot;the controller action is called&quot;
        controller.doSomething()

        then: &quot;the Mock can be used to validate cardinality and parameters&quot;
        1 * fooService.doSomething(&quot;Sally&quot;)

        and: &quot;the mocked service returns the default 'zero value' of 'null'&quot;
        response.text == null.toString()
    }
}
</code></pre>
<p>The above test mocks <code>FooService</code> by doing the following:</p>
<pre><code class="language-groovy">def fooService = Mock(FooService)
</code></pre>
<p>The test also verifies that <code>FooService.doSomething(name)</code> is called just once and the parameter passed to it is equal to a String value of &quot;Sally&quot;.</p>
<pre><code class="language-groovy">1 * fooService.doSomething(&quot;Sally&quot;)
</code></pre>
<p>The above snippets of code accomplish four important tasks:</p>
<ul>
<li>Creates a Mock for <code>FooService</code></li>
<li>Ensures the <code>FooService.doSomething(String name)</code> method is called only once and the parameter <code>name</code> is equal to the String &quot;Sally&quot;</li>
<li>Isolates the code under test by mocking the implementation of the collaborator</li>
</ul>
<h2>Stubs</h2>
<p>Does the code under test use a collaborator? Is the goal to ensure the code under test behaves properly when interacting with a collaborator? Does the collaborator act as input to the code under test?</p>
<p>If the behavior of the code under test will change based upon the behavior of the collaborator, then what you need to use is a Stub.</p>
<p>Let's take a look at the following example where we have a controller, <code>FooController</code>, which utilizes <code>FooService</code> as a collaborator and then test the functionality with a Stub.</p>
<p>FooController.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import groovy.transform.CompileStatic

@CompileStatic
class FooController {
    FooService fooService

    def doSomething() {
        render fooService.doSomething(&quot;Sally&quot;)
    }
}
</code></pre>
<p>FooService.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import groovy.transform.CompileStatic

@CompileStatic
class FooService {

    String doSomething(String name) {
        &quot;Hi &amp;#36;{name}, FooService did something&quot;
    }
}
</code></pre>
<p>Here's the test:</p>
<p>StubSpec.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import grails.testing.web.controllers.ControllerUnitTest
import spock.lang.Specification

class StubSpec extends Specification implements ControllerUnitTest&lt;FooController&gt; {

    void &quot;Stub FooService&quot;() {
        given: &quot;the collaborating service is stubbed&quot;
        def fooService = Stub(FooService) {
            doSomething(_) &gt;&gt; &quot;Stub did something&quot;
        }

        and: &quot;the stubbed service is set on the controller&quot;
        controller.fooService = fooService

        when: &quot;the controller action is called&quot;
        controller.doSomething()

        then: &quot;the stubbed service returns the stubbed text&quot;
        // 1 * fooService.doSomething() cardinality not supported by Stub
        response.text == &quot;Stub did something&quot;
    }
}
</code></pre>
<p>The above test stubs <code>FooService</code> by doing the following:</p>
<pre><code class="language-groovy">def fooService = Stub(FooService) {
    doSomething(_) &gt;&gt; &quot;Stub did something&quot;
}
</code></pre>
<p>The above code accomplishes four important tasks:</p>
<ul>
<li>Creates a Stub for <code>FooService</code></li>
<li>Ensures the <code>FooService.doSomething(String name)</code> method will return the String &quot;Stub did something&quot; independently of the <code>name</code> parameter value. Hence the use of <code>_</code>.</li>
<li>Isolates the code under test by mocking the implementation of the collaborator</li>
</ul>
<h2>Spies</h2>
<p>Please don't read this section.</p>
<p>Look away.</p>
<p>Please skip ahead to the next section.</p>
<p>Still reading this? Well, okay, let's talk about Spies.</p>
<p>Do not use Spies. As the Spock documentation states:</p>
<blockquote>
<p>Think twice before using this feature. It might be better to change the design of the code under specification.</p>
</blockquote>
<p>That being said, there are situations when we must work with legacy code. The legacy code may be difficult to test with Mocks or Stubs. In this case, Spies may the only viable option.</p>
<p>Spies are different than Mocks or Stubs because they do not act as a test duplicate in the same sense.</p>
<p>When a class is Mocked or Stubbed, a test double is created and the original code that exists within the Mocked or Stubbed object is not executed.</p>
<p>Spies, on the other hand, will execute the original code from which the Spy was created, but a Spy will also allow you to modify what the Spy returns and verify cardinality much like Mocks and Stubs.</p>
<p>Let's take a look at the following example where we have a controller, <code>FooController</code>, which utilizes <code>FooService</code> as a collaborator and then test the functionality with a Spy.</p>
<p>FooController.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import groovy.transform.CompileStatic

@CompileStatic
class FooController {
    FooService fooService

    def doSomething() {
        render fooService.doSomething(&quot;Sally&quot;)
    }
}
</code></pre>
<p>FooService.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import groovy.transform.CompileStatic

@CompileStatic
class FooService {

    String doSomething(String name) {
        &quot;Hi &amp;#36;{name}, FooService did something&quot;
    }
}
</code></pre>
<p>Here's the test:</p>
<p>SpySpec.groovy</p>
<pre><code class="language-groovy">package com.mycompany.myapp

import grails.testing.web.controllers.ControllerUnitTest
import spock.lang.Specification

class SpySpec extends Specification implements ControllerUnitTest&lt;FooController&gt; {

    void &quot;Spy FooService&quot;() { 
        given: &quot;the collaborating service is a Spy&quot;
        def fooService = Spy(FooService)

        and: &quot;the Spy service is set on the controller&quot;
        controller.fooService = fooService

        when: &quot;the controller action is called&quot;
        controller.doSomething()

        then: &quot;the Spy can be used to validate cardinality&quot;
        1 * fooService.doSomething(&quot;Sally&quot;) &gt;&gt; &quot;A Spy can modify implementation&quot;

        and: 'A spy can modify implementation'
        response.text == &quot;A Spy can modify implementation&quot;
    }
}
</code></pre>
<p>The above test creates a Spy on <code>FooService</code> by doing the following:</p>
<pre><code class="language-groovy">def fooService = Spy(FooService)
{% endhighlight %} 

The following code demonstrates how the Spy allows us to verify `FooService.doSomething(name)` is called just once and the parameter passed to it is equal to a String value of &quot;Sally&quot;:
Moreover, it changes the method implementation to return a different String.

{% highlight groovy %}
1 * fooService.doSomething(&quot;Sally&quot;) &gt;&gt; &quot;A Spy can modify implementation&quot;
</code></pre>
<p>The following code demonstrates how the Spy allows us to verify <code>FooService.doSomething(name)</code> is called just once and the parameter passed to it is equal to a String value of &quot;Sally&quot;: Moreover, it changes the method implementation to return a different String.</p>
<pre><code class="language-groovy">1 * fooService.doSomething(&quot;Sally&quot;) &gt;&gt; &quot;A Spy can modify implementation&quot;
</code></pre>
<p>The above code accomplishes four important tasks:</p>
<ul>
<li>Creates a Spy for <code>FooService</code></li>
<li>Verifies interaction with the collaborator.</li>
<li>Verifies how the application behaves when a collaborator responds in a certain way.</li>
</ul>
<h2>FAQ</h2>
<p><strong>Q:</strong> Should I use a Mock, a Stub, or a Spy?</p>
<p><strong>A:</strong> This is a question faced by many a developer. The following FAQ may help if you are ever unsure as to which mocking option to use.</p>
<p><strong>Q:</strong> Is the goal of the test to verify the contract between the code under test and a collaborator?<br />
<strong>A:</strong> If you answered yes, use Mock</p>
<p><strong>Q:</strong> Is the goal of the test to ensure the code under test behaves properly when interacting with a collaborator?<br />
<strong>A:</strong> If you answered yes, use Stub</p>
<p><strong>Q:</strong> Does the collaborator act as input to the code that is under test?<br />
<strong>A:</strong> If you answered yes, use Stub</p>
<p><strong>Q:</strong> Are you working with legacy code that is extremely difficult to test and you've exhausted all other options?<br />
<strong>A:</strong> Try using a Spy</p>
<h2>Sample Code</h2>
<p>The sample code referenced in this post may be found at <a href="https://github.com/ddelponte/mock-stub-spy">https://github.com/ddelponte/mock-stub-spy</a></p>
<h2>Useful Links</h2>
<ul>
<li><a href="https://spockframework.org/spock/docs/1.1/all_in_one.html#_interaction_based_testing">https://spockframework.org/spock/docs/1.1/all_in_one.html#_interaction_based_testing</a></li>
<li><a href="https://martinfowler.com/bliki/UnitTest.html">https://martinfowler.com/bliki/UnitTest.html</a></li>
<li><a href="https://martinfowler.com/articles/mocksArentStubs.html">https://martinfowler.com/articles/mocksArentStubs.html</a></li>
</ul>
    <h2 class='space-above'>
      <span>You might also like ...</span>
    </h2>
    <div class='threecolumns'>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/grails-blog-index-6.png)'>
  <a href='https://grails.org/blog/2021-04-07-publish-grails-plugin-to-maven-central.html'>
    <h3>April 7, 2021</h3>
    <h2>How to Publish a Grails Plugin to the Maven C...</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/grails-blog-index-6.png)'>
  <a href='https://grails.org/blog/2021-03-22-meet-the-new-mascot.html'>
    <h3>March 22, 2021</h3>
    <h2>Meet the GrailsÂ® Framework's New Mascot, Sir ...</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/grails-blog-index-5.png)'>
  <a href='https://grails.org/blog/2021-02-12-alerts-regarding-bintray-sunset.html'>
    <h3>February 12, 2021</h3>
    <h2>Important Information Regarding Grails and Bi...</h2>
  </a>
</article></div>
    </div>
  </div>
</div>&nbsp;</article>
<footer>
    <div class='content'>
        <div class='ocihometograils'>
            <span>Sponsored by</span>
            <a href='https://objectcomputing.com/products/grails/'><img class='' src='https://grails.org/images/oci-logo.svg' alt='Object Computing is proud to be home to  the Grails framework' width='300px' /></a>
            <span>&copy; 2021 Object Computing, Inc. All rights reserved.</span>
        </div>
        <nav class='socialmedianav'><ul>
            <li>
                <a href='https://slack.grails.org'><img class='' src='https://grails.org/images/slack.svg' alt='Slack Icon' /></a>
            </li>
            <li>
                <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='https://grails.org/images/youtube.svg' alt='Youtube Icon' /></a>
            </li>
            <li>
                <a href='https://www.linkedin.com/groups/39757'><img class='' src='https://grails.org/images/linkedin.svg' alt='LinkedIn Icon' /></a>
            </li>
            <li>
                <a href='https://github.com/grails/'><img class='' src='https://grails.org/images/github.svg' alt='Github Icon' /></a>
            </li>
            <li>
                <a href='https://twitter.com/grailsframework'><img class='' src='https://grails.org/images/twitter.svg' alt='Twitter Icon' /></a>
            </li>
        </ul></nav>
        <nav class='partnersnav'><ul>
            <li>Grails' repositories are hosted by
                <a href='https://grails.jfrog.io/'>Artifactory</a>
            </li>
            <li>Website hosting provided by
                <a href="https://aws.amazon.com/">AWS</a>
            </li>
            <li>JetBrains supports Grails with its
                <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
            </li>
            <li>YourKit supports Grails with its
                <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
            </li>
            <li>Grails is Open Source
                <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache 2 License</a>
            </li>
             <li>
                <a href='https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=grails'>Security/Vulnerability Information</a>
            </li>
            <li>
                <a href='https://grails.org/buildstatus.html'>Build Status</a>
            </li>
        </ul></nav>
    </div>
</footer><div>
    <script type='text/javascript'>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-82213539-2', 'auto');
        ga('send', 'pageview');
    </script>
    <script type='text/javascript'>
        adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
        adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
        /* OPTIONAL: provide email to improve user identification */
        /* adroll_email = "username@example.com"; */
        (function () {
            var _onload = function(){
                if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
                if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
                var scr = document.createElement("script");
                var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "https://a.adroll.com");
                scr.setAttribute('async', 'true');
                scr.type = "text/javascript";
                scr.src = host + "/j/roundtrip.js";
                ((document.getElementsByTagName('head') || [null])[0] ||
                    document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
            };
            if (window.addEventListener) {window.addEventListener('load', _onload, false);}
            else {window.attachEvent('onload', _onload)}
        }());
    </script>
</div>
</body>
</html>
