<!DOCTYPE html>
<html>
<head>
    <title>Grails® Domain Read-Only Attribute</title>
    <meta name="keywords" content="grails,jvm,framework,groovy,gradle,spring-boot,gorm" />
    <meta name="description" content="Learn how to make a domain attribute read-only in Grails® apps." />
    <meta name="date" content="October 2, 2018" />
    <meta name="robots" content="all"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://grails.org/rss.xml" />
    <meta charset='UTF-8' />
    <link rel='icon' href='https://grails.org/images/favicon.ico'/>
    <meta name='twitter:card' content='summary_large_image'/>
    <meta name='twitter:site' content='@grailsframework'/>
    <meta name='twitter:description' content='Learn how to make a domain attribute read-only in Grails® apps.'/>
    <meta name='twitter:creator' content='@grailsframework'/>
    <meta property='og:image' content='https://grails.org/images/grails.png'/>
    <meta property='og:image:width' content='300'/>
    <meta property='og:image:height' content='300'/>
    <meta property='og:url' content='https://grails.org'/>
    <meta property='og:title' content='Grails® Domain Read-Only Attribute'/>
    <meta property='og:description' content='Learn how to make a domain attribute read-only in Grails® apps.'/>
    <meta property='og:type' content='website'/>

    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='mask-icon' href='https://grails.org/images/grails-pinned-icon.svg' color='feb672' />
    <link rel='stylesheet' href='https://grails.org/stylesheets/screen.css' />
    <script src='https://grails.org/javascripts/navigation.js'></script>
    
    <link rel='stylesheet' href='https://grails.org/stylesheets/prism.css'/>
    <script src='https://grails.org/javascripts/prism.js'></script>
</head>
<body><header class='mainheader'>
    <div class='content'>
        <a href='https://grails.org/index.html'><img class='grailslogo' src='https://grails.org/images/grails_logo.svg' alt='Grails Logo' /></a>
        <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
        <div id='topmenus'>
            <nav class='secondarymenu' id='secondarymenu'><ul>
                <li><a href='https://grails.org/blog/index.html'>Blog</a></li>
                <li><a href='https://grails.org/learning.html'>Learning</a></li>
                <li><a href='https://grails.org/community.html'>Community</a></li>
                <li><a href='https://grails.org/search.html'>Search</a></li>
            </ul></nav>
            <nav class='mainmenu' id='mainmenu'><ul>
                <li><a href='https://grails.org/documentation.html'>Documentation</a></li>
                <li><a href='https://grails.org/download.html'>Download</a></li>
                <li><a href='https://plugins.grails.org'>Plugins</a></li>
                <li><a href='https://guides.grails.org/index.html'>Guides</a></li>
                <li><a href='https://grails.org/foundation/index.html'>Foundation</a></li>
                <li><a href='https://grails.org/faq.html'>FAQ</a></li>
                <li><a href='https://grails.org/support.html'>Support</a></li>
            </ul></nav>
        </div>
    </div>
</header>
<article><div class='headerbar chalicesbg'>
  <div class='content'>
    <h1>
      <a href='https://grails.org/blog/index.html'>Grails Blog</a>
    </h1>
  </div>
</div>
<div class='content container'>
  <div class='light padded blogpost'><h1>Grails® Domain Read-Only Attribute</h1>
<p><span class="author">By Nirav Assar</span></p>
<p><span class="date">October 2, 2018</span></p>
<p>Tags: <a href="https://grails.org/blog/tag/gorm.html"><span class="hashtag">#gorm</span></a></p>
<p>Recently I encountered a situation with a client Grails<sup>®</sup> application that required a read-only domain attribute. The application had a backend table where one column (call it <code>A</code>) was populated strictly by a batch database process. The table needed to be mapped to a Grails domain class. Certain columns (call them <code>B through D</code>) were to be updated from the UI. Attribute <code>A</code> should not be writable, but needed to be accessed for read-only operations.</p>
<h2>The Problem</h2>
<p>The catch here is when an update occurs on a mapped domain class, GORM with Hibernate issues an update on all columns, regardless of which columns have a value change. So even if attribute <code>B</code> is changed, an update will be issued on all columns <code>A through D</code>. If the database is configured with a specific column as read-only, you will get an error along the lines of: &quot;failure to insert into a read-only column&quot;.</p>
<p>We propose two solutions:</p>
<ul>
<li>Derived Properties</li>
<li>Hibernate's Dynamic update.</li>
</ul>
<h2>Example</h2>
<p>Let's contrive a simple example with a domain class to understand the issue. Perhaps there is a <code>Team</code> with a <code>name</code>, <code>coach</code>, and <code>nationalRank</code>. <code>name</code> and <code>coach</code> are read-write attributes while <code>nationalRank</code> is the attribute which is read-only. It is updated strictly by a database batch process.</p>
<pre><code class="language-groovy">package grails.readonly.attribute

class Team {

    String name
    String coach
    Integer nationalRank

    static mapping = {
    }
}
</code></pre>
<p>Given a row already exists, we then issue an update with the statement:</p>
<pre><code class="language-groovy">team.name= &quot;Raiders&quot;
team.save(flush: true)
</code></pre>
<p>Hibernate will generate the log shown below. As you can see <code>nationalRank</code> is included in the statement, which will end up in an error due to the database constraint of read-only.</p>
<pre><code class="language-groovy">Hibernate: update team set version=?, national_rank=?, coach=?, name=? where id=? and version=?
</code></pre>
<h2>Derived Properties</h2>
<p>To prevent hibernate from including an attribute in the update statement, we can use the <code>formula</code> mapping for <code>nationalRank</code>. This means that GORM will allow us to access the property as though it were a normal column, but will ignore it for update operations (because formulas are, by definition, not updateable). In this case, the formula simply returns the value of the column, but the net effect gives us the desired behavior.</p>
<pre><code class="language-groovy">package grails.readonly.attribute

class Team {

    String name
    String coach
    Integer nationalRank

    static mapping = {
        nationalRank nullable: false, formula: 'NATIONAL_RANK'
    }
}
</code></pre>
<p>Now upon updates, the following hibernate log is generated (note the omission of <code>nationalRank</code>):</p>
<pre><code class="language-groovy">Hibernate: update team set version=?, coach=?, name=? where id=? and version=?
</code></pre>
<p>A derived property is one that takes its value from a SQL expression. E.g., <code>tax formula: 'PRICE * TAX_RATE'</code>. The formula expressed in the ORM DSL references to NATIONAL_RANK instead nationalRank. We are echoing a value which must be set elsewhere and cannot be inserted through GORM. So returning the column value directly achieves a read-only effect. <a href="http://gorm.grails.org/6.1.x/hibernate/manual/#derivedProperties">DerivedProperties</a></p>
<h2>DynamicUpdate</h2>
<p>An alternate way of achieving the same result is to use hibernate's <code>dynamicUpdate</code> mapping. <code>dynamicUpdate</code> tells Hibernate whether to include unmodified properties in the SQL UPDATE statement. This excludes any attribute from the update statement which is not dirty.</p>
<pre><code class="language-groovy">package grails.readonly.attribute

class Team {

    String name
    String coach
    Integer nationalRank

    static mapping = {
        dynamicUpdate true
    }
}
</code></pre>
    <h2 class='space-above'>
      <span>You might also like ...</span>
    </h2>
    <div class='threecolumns'>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/2018-04-05.jpg)'>
  <a href='https://grails.org/blog/2018-04-05.html'>
    <h3>April 5, 2018</h3>
    <h2>Introducing the Grails® 3 GORM Logical Delete...</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/2018-03-09.jpg)'>
  <a href='https://grails.org/blog/2018-03-09.html'>
    <h3>March 9, 2018</h3>
    <h2>Webinar: Build a Better API with GORM &amp; Graph...</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.org/images/2017-06-27.jpg)'>
  <a href='https://grails.org/blog/2017-06-27.html'>
    <h3>June 27, 2017</h3>
    <h2>Checked Exceptions Rollback Transactions Sinc...</h2>
  </a>
</article></div>
    </div>
  </div>
</div>&nbsp;</article>
<footer>
    <div class='content'>
        <div class='ocihometograils'>
            <span>Sponsored by</span>
            <a href='https://objectcomputing.com/products/grails/'><img class='' src='https://grails.org/images/oci_home_to_grails.svg' alt='Object Computing - Home to Grails' width='300px' /></a>
        </div>
        <nav class='socialmedianav'><ul>
            <li>
                <a href='https://slack.grails.org'><img class='' src='https://grails.org/images/slack.svg' alt='Slack Icon' /></a>
            </li>
            <li>
                <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='https://grails.org/images/youtube.svg' alt='Youtube Icon' /></a>
            </li>
            <li>
                <a href='https://www.linkedin.com/groups/39757'><img class='' src='https://grails.org/images/linkedin.svg' alt='LinkedIn Icon' /></a>
            </li>
            <li>
                <a href='https://github.com/grails/'><img class='' src='https://grails.org/images/github.svg' alt='Github Icon' /></a>
            </li>
            <li>
                <a href='https://twitter.com/grailsframework'><img class='' src='https://grails.org/images/twitter.svg' alt='Twitter Icon' /></a>
            </li>
        </ul></nav>
        <nav class='partnersnav'><ul>
            <li>Grails' repositories are hosted by
                <a href='http://artifactoryonline.com/'>Artifactory</a>
            </li>
            <li>Website hosting provided by
                <a href="https://aws.amazon.com/">AWS</a>
            </li>
            <li>JetBrains supports Grails with its
                <a href='https://www.jetbrains.com/idea/'>IntelliJ IDEA IDE</a>
            </li>
            <li>YourKit supports Grails with its
                <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
            </li>
            <li>Grails is Open Source
                <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache 2 License</a>
            </li>
             <li>
                <a href='https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=grails'>Security/Vulnerability Information</a>
            </li>
            <li>
                <a href='https://grails.org/buildstatus.html'>Build Status</a>
            </li>
        </ul></nav>
    </div>
</footer><div>
    <script type='text/javascript'>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-82213539-2', 'auto');
        ga('send', 'pageview');
    </script>
    <script type='text/javascript'>
        adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
        adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
        /* OPTIONAL: provide email to improve user identification */
        /* adroll_email = "username@example.com"; */
        (function () {
            var _onload = function(){
                if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
                if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
                var scr = document.createElement("script");
                var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
                scr.setAttribute('async', 'true');
                scr.type = "text/javascript";
                scr.src = host + "/j/roundtrip.js";
                ((document.getElementsByTagName('head') || [null])[0] ||
                    document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
            };
            if (window.addEventListener) {window.addEventListener('load', _onload, false);}
            else {window.attachEvent('onload', _onload)}
        }());
    </script>
</div>
</body>
</html>
